<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>福岡旅行</title>

  <!-- PWA / iPhone -->
  <link rel="manifest" href="/manifest.json" />
  <link rel="apple-touch-icon" href="/icons/icon-180.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="福岡旅行" />
  <meta name="theme-color" content="#b91c1c" />

  <!-- Tailwind / React / Babel -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* 3択ダイアログ */
    #mapDialog{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:1000}
    #mapDialog .panel{width:92%;max-width:340px;background:#fff;border-radius:16px;padding:16px 16px 12px;box-shadow:0 10px 25px rgba(0,0,0,.18)}
    #mapDialog h3{font-size:16px;font-weight:600;margin:4px 0 10px;word-break:keep-all}
    #mapDialog .btn{width:100%;border:none;border-radius:10px;padding:12px 14px;font-size:15px;margin-top:8px}
    #mapDialog .google{background:#4285F4;color:#fff}
    #mapDialog .apple{background:#111;color:#fff}
    #mapDialog .cancel{background:#e5e7eb;color:#111}
  </style>
</head>
<body class="bg-gray-100 text-gray-900">
  <!-- 3択ダイアログ -->
  <div id="mapDialog" onclick="closeDialog()">
    <div class="panel" onclick="event.stopPropagation()">
      <div class="text-xs text-gray-500">地図を開く</div>
      <h3 id="mapPlace">場所名</h3>
      <button class="btn google" onclick="goGoogle()">Google Map</button>
      <button class="btn apple"  onclick="goApple()">Apple Map</button>
      <button class="btn cancel" onclick="closeDialog()">戻る</button>
    </div>
  </div>

  <div id="root"></div>

  <script type="text/babel">
  const { useEffect } = React;

  /* ---- レイアウト定数（時間列/レール列の幅） ---- */
  const TIME_COL = 72;   // px
  const RAIL_COL = 20;   // px（中央にレール、丸の直径12px）
  const GRID_GAP = 16;   // 列間の隙間
  const DOT_DIAM = 12;   // 丸の直径
  const RAIL_LEFT_PX = TIME_COL + GRID_GAP + (RAIL_COL/2); // Day 全体レールの X

  /* ---- マップダイアログ ---- */
  const gSearch = q => `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q)}`;
  const aSearch = q => `https://maps.apple.com/?q=${encodeURIComponent(q)}`;
  let currentPlace = "";
  window.openMapDialog = (place)=>{ currentPlace=place; document.getElementById("mapPlace").innerText=place; document.getElementById("mapDialog").style.display="flex"; };
  window.closeDialog = ()=>{ document.getElementById("mapDialog").style.display="none"; currentPlace=""; };
  window.goGoogle = ()=>{ window.open(gSearch(currentPlace), "_blank"); closeDialog(); };
  window.goApple  = ()=>{ window.open(aSearch(currentPlace), "_blank"); closeDialog(); };

  /* ---- データ ---- */
  const day2_3LunchCandidates = [
    { name: "元祖 博多めんたい重" },
    { name: "博多シーフード うお田" },
    { name: "魚ト肴 いとおかし（春吉）" },
    { name: "ひしむら（春吉）" },
    { name: "大地のうどん 博多駅ちかてん（朝日ビルB2）" },
  ];
  const airportLunchCandidates = [
    { name: "竹乃屋 福岡空港店" },
    { name: "ラーメン滑走路（フードホール）" },
    { name: "因幡うどん（福岡空港）" },
    { name: "うまや 福岡空港店" },
    { name: "B.B.Quisine（国内線3F）" },
  ];
  const timeline = [
    {
      day: "Day 1 (9/19 金)",
      events: [
        { time:"12:10", title:"🛫 名古屋発（飛行機）", detail:"12:10 → 13:35", hideMaps:true },
        { time:"12:15", title:"🛫 東京発（飛行機）",   detail:"12:15 → 14:10", hideMaps:true },
        { time:"15:00", title:"🍴 お昼", detail:"空港内の候補（10人以上OK）", candidates:airportLunchCandidates },
        { time:"16:00", title:"🏨 チェックイン", detail:"HOTEL 粋 - sui - HARUYOSHI（旧Grand Base Fukuoka）", mapsQ:"HOTEL 粋 - sui - HARUYOSHI" },
        { time:"16:30", title:"🚴 自転車観光", detail:"大濠公園 / 福岡城跡 / 博多ポートタワー / 櫛田神社 / 承天寺通り など",
          candidates:[{name:"大濠公園"},{name:"福岡城跡（舞鶴公園）"},{name:"博多ポートタワー"},{name:"櫛田神社"},{name:"承天寺通り"}] },
        { time:"20:30", title:"🍲 夜ご飯", detail:"元祖 もつ鍋 楽天地 天神本店（アクロス福岡 B2F）", mapsQ:"元祖 もつ鍋 楽天地 天神本店" },
        { time:"22:00", title:"🕒 自由時間", hideMaps:true },
      ]
    },
    {
      day: "Day 2 (9/20 土)",
      events: [
        { time:"12:00", title:"🍴 お昼（候補）", detail:"候補から選択", candidates:day2_3LunchCandidates },
        { time:"14:00", title:"🎯 アクティビティ", detail:"EXBAR TOKYO plus 博多（キャナルシティ博多 5F）", mapsQ:"EXBAR TOKYO plus 博多" },
        { time:"18:00", title:"🍺 夜ご飯", detail:"海鮮居酒屋 まる家 西中洲", mapsQ:"海鮮居酒屋 まる家 西中洲" },
        { time:"20:00", title:"🍸 2件目（未定）", hideMaps:true },
        { time:"22:00", title:"🕒 自由時間", hideMaps:true },
      ]
    },
    {
      day: "Day 3 (9/21 日)",
      events: [
        { time:"12:00", title:"🍴 お昼（候補）", detail:"候補から選択", candidates:day2_3LunchCandidates },
        { time:"13:00", title:"🛍️ 空港ショッピング（お土産）",
          candidates:[{name:"ANA FESTA（国内線）"},{name:"博多銘品蔵"},{name:"そらもーる商店"},{name:"福太郎（明太子）"},{name:"東雲堂（にわかせんぺい）"}] },
        { time:"14:15", title:"🛬 東京組 帰り（飛行機）", detail:"14:15 → 16:05", hideMaps:true },
        { time:"14:50", title:"🛬 名古屋組 帰り（飛行機）", detail:"14:50 → 16:40", hideMaps:true },
      ]
    }
  ];

  /* ---- UI ---- */
  const Pill = ({children,onClick})=>(
    <button onClick={onClick} className="inline-block px-4 py-2 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-800 text-sm">
      {children}
    </button>
  );

  function EventRow({ time, title, detail, mapsQ, hideMaps, candidates }) {
    return (
      <div
        className="grid items-center mb-8"
        style={{ gridTemplateColumns: `${TIME_COL}px ${RAIL_COL}px 1fr`, columnGap: `${GRID_GAP}px` }}
      >
        {/* 時間（等幅でズレ防止） */}
        <div className="text-right font-bold text-gray-800 tabular-nums">{time}</div>

        {/* 丸（縦線は Day コンテナの1本を使用） */}
        <div className="relative flex items-center justify-center">
          <div className="w-[12px] h-[12px] bg-blue-600 rounded-full"></div>
        </div>

        {/* カード */}
        <div className="bg-white rounded-2xl shadow p-4">
          <div className="font-semibold text-gray-900 text-lg">{title}</div>
          {detail && <div className="text-sm text-gray-600 mt-1">{detail}</div>}

          {!hideMaps && mapsQ && (
            <div className="mt-3"><Pill onClick={()=>openMapDialog(mapsQ)}>地図を開く</Pill></div>
          )}

          {candidates && (
            <div className="mt-3">
              <div className="text-xs text-gray-500 mb-2">候補（タップでマップを選択）</div>
              <div className="flex flex-wrap gap-2">
                {candidates.map((s,i)=>(<Pill key={i} onClick={()=>openMapDialog(s.name)}>{s.name}</Pill>))}
              </div>
            </div>
          )}
        </div>
      </div>
    );
  }

  function DaySection({ day, events }) {
    return (
      <div className="mb-12">
        <h2 className="text-xl font-semibold mb-6 border-b pb-2">{day}</h2>

        {/* Day 全体のレール（上/下に少し余白 → 丸に当てない） */}
        <div className="relative">
          <div
            className="absolute bg-gray-300"
            style={{
              left: `${RAIL_LEFT_PX}px`,
              top: 10,               // ←上の余白（丸に当たらない）
              bottom: 10,            // ←下の余白（丸に当たらない）
              width: 2,
              borderRadius: 9999
            }}
          ></div>

          {/* イベント本体 */}
          <div>
            {events.map((ev,i)=>(<EventRow key={i} {...ev} />))}
          </div>
        </div>
      </div>
    );
  }

  function App(){
    useEffect(()=>{ if("serviceWorker" in navigator){ navigator.serviceWorker.register("/sw.js").catch(()=>{});} },[]);
    return (
      <div
        className="p-6 md:p-8 w-full min-h-screen flex flex-col items-center"
        style={{ paddingTop: 'calc(env(safe-area-inset-top, 0px) + 16px)' }}  // タイトルが被らないよう余白
      >
        <h1 className="text-3xl font-bold tracking-wide mt-2">福岡旅行</h1>
        <p className="text-sm text-gray-600 mb-6">期間：2025.09.19 - 2025.09.21</p>

        <div className="w-full max-w-4xl">
          {timeline.map((d,idx)=>(<DaySection key={idx} {...d} />))}
        </div>

        <footer className="mt-2 text-xs text-gray-500 text-center pb-10">
          📌 iPhoneでホーム画面に追加：Safariで開く → 共有（□に↑）→ <b>ホーム画面に追加</b>
        </footer>
      </div>
    );
  }

  ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
